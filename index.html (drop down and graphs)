<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gene Statement Counts for Neurodegenerative Diseases (Dynamic Dropdown)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body { font-family: Arial; margin: 30px; }
    select { font-size: 16px; padding: 6px; margin-bottom: 20px; }
</style>
</head>

<body>
<!-- ===================== TITLE AREA ===================== -->
<header style="margin-bottom: 25px;">
    <h1 style="font-size: 32px; margin-bottom: 10px;">
        Neurodegenerative Diseases
    </h1>
    
    <!-- SMALL INTRO TEXT -->
    <p style="font-size: 16px; max-width: 700px; line-height: 1.5; color: #444;">
        Neurodegenerative diseases such as Alzheimer’s disease and ALS involve 
        progressive loss of neurons and are influenced by both genetic and 
        environmental factors. This tool aims to provide knowledge on genes relevant to both diseases, and inform potential gene carriers. 

    </p>
</header>


<h2>Gene Statement Counts for Neurodegenerative Diseases</h2>

<label for="diseaseSelect"><strong>Select a disease:</strong></label>
<select id="diseaseSelect">
    <option value="Q11085">Alzheimer’s disease</option>
    <option value="Q11081">ALS (Amyotrophic lateral sclerosis)</option>
</select>

<canvas id="geneChart" width="900" height="450"></canvas>

<script>
// ============================================================
// Fetch gene + statement count for SELECTED disease
// ============================================================
async function fetchGeneStatementCounts(diseaseQID) {
    const endpoint = "https://query.wikidata.org/sparql";

    const query = `
    SELECT ?gene ?geneLabel (COUNT(?p) AS ?statementCount)
    WHERE {
      # Genes associated with selected disease
      ?gene (wdt:P2293|wdt:P1542|wdt:P828|wdt:P3354|wdt:P3433) wd:${diseaseQID} .
      ?gene ?p ?o .
      FILTER(STRSTARTS(STR(?p), "http://www.wikidata.org/prop/direct/"))
      SERVICE wikibase:label { bd:serviceParam wikibase:language "en" }
    }
    GROUP BY ?gene ?geneLabel
    ORDER BY DESC(?statementCount)
    `;

    const url = endpoint + "?query=" + encodeURIComponent(query);

    const response = await fetch(url, {
        headers: { "Accept": "application/sparql-results+json" }
    });

    const json = await response.json();

    return json.results.bindings.map(row => ({
        gene: row.geneLabel.value,
        count: parseInt(row.statementCount.value)
    }));
}

// ============================================================
// Draw chart (replace old one if exists)
// ============================================================
let currentChart = null;

function drawChart(data, title) {
    const ctx = document.getElementById("geneChart").getContext("2d");

    if (currentChart !== null) {
        currentChart.destroy();
    }

    currentChart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: data.map(x => x.gene),
            datasets: [{
                label: title,
                data: data.map(x => x.count),
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgb(75, 192, 192)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: false,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: "Statement Count" }},
                x: { title: { display: true, text: "Gene" }}
            }
        }
    });
}

// ============================================================
// MAIN: Update chart when dropdown changes
// ============================================================
async function updateChart() {
    const diseaseQID = document.getElementById("diseaseSelect").value;

    const diseaseName = {
        "Q11085": "Alzheimer’s",
        "Q11081": "ALS"
    }[diseaseQID];

    const data = await fetchGeneStatementCounts(diseaseQID);

    drawChart(data, `${diseaseName} Gene Statements`);
}

// When dropdown changes → update chart
document.getElementById("diseaseSelect").addEventListener("change", updateChart);

// Load initial chart (Alzheimer’s by default)
updateChart();

</script>

</body>
</html>
